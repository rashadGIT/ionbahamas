{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require(\"react-dom\");\n\nvar _classnames = require(\"classnames\");\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _Selection = require(\"./Selection\");\n\nvar _Selection2 = _interopRequireDefault(_Selection);\n\nvar _dates = require(\"./utils/dates\");\n\nvar _dates2 = _interopRequireDefault(_dates);\n\nvar _selection = require(\"./utils/selection\");\n\nvar _localizer = require(\"./localizer\");\n\nvar _localizer2 = _interopRequireDefault(_localizer);\n\nvar _helpers = require(\"./utils/helpers\");\n\nvar _propTypes3 = require(\"./utils/propTypes\");\n\nvar _accessors = require(\"./utils/accessors\");\n\nvar _dayViewLayout = require(\"./utils/dayViewLayout\");\n\nvar _dayViewLayout2 = _interopRequireDefault(_dayViewLayout);\n\nvar _TimeColumn = require(\"./TimeColumn\");\n\nvar _TimeColumn2 = _interopRequireDefault(_TimeColumn);\n\nvar _calendar = require(\"./calendar.scss\");\n\nvar _calendar2 = _interopRequireDefault(_calendar);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nfunction snapToSlot(date, step) {\n  var roundTo = 1000 * 60 * step;\n  return new Date(Math.floor(date.getTime() / roundTo) * roundTo);\n}\n\nfunction startsAfter(date, max) {\n  return _dates2.default.gt(_dates2.default.merge(max, date), max, \"minutes\");\n}\n\nvar DayColumn = function (_React$Component) {\n  _inherits(DayColumn, _React$Component);\n\n  function DayColumn() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, DayColumn);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = DayColumn.__proto__ || Object.getPrototypeOf(DayColumn)).call.apply(_ref, [this].concat(args))), _this), _initialiseProps.call(_this), _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(DayColumn, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.selectable && this._selectable();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._teardownSelectable();\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.selectable && !this.props.selectable) {\n        this._selectable();\n      }\n\n      if (!nextProps.selectable && this.props.selectable) {\n        this._teardownSelectable();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _props = this.props,\n          getNow = _props.getNow,\n          min = _props.min,\n          max = _props.max,\n          step = _props.step,\n          selectRangeFormat = _props.selectRangeFormat,\n          culture = _props.culture,\n          dayPropGetter = _props.dayPropGetter,\n          props = _objectWithoutProperties(_props, [\"getNow\", \"min\", \"max\", \"step\", \"selectRangeFormat\", \"culture\", \"dayPropGetter\"]);\n\n      this._totalMin = _dates2.default.diff(min, max, \"minutes\");\n      var _state = this.state,\n          selecting = _state.selecting,\n          startSlot = _state.startSlot,\n          endSlot = _state.endSlot;\n\n      var slotStyle = this._slotStyle(startSlot, endSlot);\n\n      var selectDates = {\n        start: this.state.startDate,\n        end: this.state.endDate\n      };\n\n      var _ref2 = dayPropGetter && dayPropGetter(max) || {},\n          className = _ref2.className,\n          style = _ref2.style;\n\n      return _react2.default.createElement(_TimeColumn2.default, _extends({}, props, {\n        className: (0, _classnames2.default)(_calendar2.default.rbcDaySlot, className),\n        style: style,\n        getNow: getNow,\n        min: min,\n        max: max,\n        step: step\n      }), _react2.default.createElement(\"div\", {\n        className: (0, _classnames2.default)(_calendar2.default.rbcEventsContainer, {\n          rtl: this.props.rtl\n        })\n      }, this.renderEvents()), selecting && _react2.default.createElement(\"div\", {\n        className: _calendar2.default.rbcSlotSelection,\n        style: slotStyle\n      }, _react2.default.createElement(\"span\", null, _localizer2.default.format(selectDates, selectRangeFormat, culture))));\n    }\n  }]);\n\n  return DayColumn;\n}(_react2.default.Component);\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this2 = this;\n\n  this.state = {\n    selecting: false\n  };\n\n  this.renderEvents = function () {\n    var _props2 = _this2.props,\n        EventComponent = _props2.components.event,\n        culture = _props2.culture,\n        endAccessor = _props2.endAccessor,\n        eventPropGetter = _props2.eventPropGetter,\n        eventTimeRangeEndFormat = _props2.eventTimeRangeEndFormat,\n        eventTimeRangeFormat = _props2.eventTimeRangeFormat,\n        eventTimeRangeStartFormat = _props2.eventTimeRangeStartFormat,\n        EventWrapper = _props2.eventWrapperComponent,\n        events = _props2.events,\n        max = _props2.max,\n        messages = _props2.messages,\n        min = _props2.min,\n        isRtl = _props2.rtl,\n        selected = _props2.selected,\n        showMultiDayTimes = _props2.showMultiDayTimes,\n        startAccessor = _props2.startAccessor,\n        step = _props2.step,\n        timeslots = _props2.timeslots,\n        titleAccessor = _props2.titleAccessor,\n        tooltipAccessor = _props2.tooltipAccessor;\n    var styledEvents = (0, _dayViewLayout2.default)({\n      events: events,\n      startAccessor: startAccessor,\n      endAccessor: endAccessor,\n      min: min,\n      showMultiDayTimes: showMultiDayTimes,\n      totalMin: _this2._totalMin,\n      step: step,\n      timeslots: timeslots\n    });\n    return styledEvents.map(function (_ref3, idx) {\n      var _extends2;\n\n      var event = _ref3.event,\n          style = _ref3.style;\n      var _eventTimeRangeFormat = eventTimeRangeFormat;\n      var _continuesPrior = false;\n      var _continuesAfter = false;\n      var start = (0, _accessors.accessor)(event, startAccessor);\n      var end = (0, _accessors.accessor)(event, endAccessor);\n\n      if (start < min) {\n        start = min;\n        _continuesPrior = true;\n        _eventTimeRangeFormat = eventTimeRangeEndFormat;\n      }\n\n      if (end > max) {\n        end = max;\n        _continuesAfter = true;\n        _eventTimeRangeFormat = eventTimeRangeStartFormat;\n      }\n\n      var continuesPrior = (0, _dayViewLayout.startsBefore)(start, min);\n      var continuesAfter = startsAfter(end, max);\n      var title = (0, _accessors.accessor)(event, titleAccessor);\n      var tooltip = (0, _accessors.accessor)(event, tooltipAccessor);\n      var label = void 0;\n\n      if (_continuesPrior && _continuesAfter) {\n        label = messages.allDay;\n      } else {\n        label = _localizer2.default.format({\n          start: start,\n          end: end\n        }, _eventTimeRangeFormat, culture);\n      }\n\n      var _isSelected = (0, _selection.isSelected)(event, selected);\n\n      var _ref4 = eventPropGetter && eventPropGetter(event, start, end, _isSelected),\n          xStyle = _ref4.style,\n          className = _ref4.className;\n\n      var height = style.height,\n          top = style.top,\n          width = style.width,\n          xOffset = style.xOffset;\n      return _react2.default.createElement(EventWrapper, {\n        event: event,\n        key: \"evt_\" + idx\n      }, _react2.default.createElement(\"div\", {\n        style: _extends({}, xStyle, (_extends2 = {\n          top: top + \"%\",\n          height: height + \"%\"\n        }, _defineProperty(_extends2, isRtl ? \"right\" : \"left\", Math.max(0, xOffset) + \"%\"), _defineProperty(_extends2, \"width\", width + \"%\"), _extends2)),\n        title: tooltip ? (typeof label === \"string\" ? label + \": \" : \"\") + tooltip : undefined,\n        onClick: function onClick(e) {\n          return _this2._select(event, e);\n        },\n        onDoubleClick: function onDoubleClick(e) {\n          return _this2._doubleClick(event, e);\n        },\n        className: (0, _classnames2.default)(_calendar2.default.rbcEvent, className, continuesPrior ? _calendar2.default.rbcEventContinuesEarlier : \"\", continuesAfter ? _calendar2.default.rbcEventContinuesLater : \"\", _continuesPrior ? _calendar2.default.rbcEventContinuesDayPrior : \"\", _continuesAfter ? _calendar2.default.rbcEventContinuesDayAfter : \"\")\n      }, _react2.default.createElement(\"div\", {\n        className: _calendar2.default.rbcEventLabel\n      }, label), _react2.default.createElement(\"div\", {\n        className: _calendar2.default.rbcEventContent\n      }, EventComponent ? _react2.default.createElement(EventComponent, {\n        event: event,\n        title: title\n      }) : title)));\n    });\n  };\n\n  this._slotStyle = function (startSlot, endSlot) {\n    var top = startSlot / _this2._totalMin * 100;\n    var bottom = endSlot / _this2._totalMin * 100;\n    return {\n      top: top + \"%\",\n      height: bottom - top + \"%\"\n    };\n  };\n\n  this._selectable = function () {\n    var node = (0, _reactDom.findDOMNode)(_this2);\n    var selector = _this2._selector = new _Selection2.default(function () {\n      return (0, _reactDom.findDOMNode)(_this2);\n    }, {\n      longPressThreshold: _this2.props.longPressThreshold\n    });\n\n    var maybeSelect = function maybeSelect(box) {\n      var onSelecting = _this2.props.onSelecting;\n      var current = _this2.state || {};\n      var state = selectionState(box);\n      var start = state.startDate,\n          end = state.endDate;\n\n      if (onSelecting) {\n        if (_dates2.default.eq(current.startDate, start, \"minutes\") && _dates2.default.eq(current.endDate, end, \"minutes\") || !onSelecting({\n          start: start,\n          end: end\n        })) {\n          return;\n        }\n      }\n\n      _this2.setState(state);\n    };\n\n    var selectionState = function selectionState(_ref5) {\n      var y = _ref5.y;\n      var _props3 = _this2.props,\n          step = _props3.step,\n          min = _props3.min,\n          max = _props3.max;\n\n      var _getBoundsForNode = (0, _Selection.getBoundsForNode)(node),\n          top = _getBoundsForNode.top,\n          bottom = _getBoundsForNode.bottom;\n\n      var mins = _this2._totalMin;\n      var range = Math.abs(top - bottom);\n      var current = (y - top) / range;\n      current = snapToSlot(minToDate(mins * current, min), step);\n\n      if (!_this2.state.selecting) {\n        _this2._initialDateSlot = current;\n      }\n\n      var initial = _this2._initialDateSlot;\n\n      if (_dates2.default.eq(initial, current, \"minutes\")) {\n        current = _dates2.default.add(current, step, \"minutes\");\n      }\n\n      var start = _dates2.default.max(min, _dates2.default.min(initial, current));\n\n      var end = _dates2.default.min(max, _dates2.default.max(initial, current));\n\n      return {\n        selecting: true,\n        startDate: start,\n        endDate: end,\n        startSlot: (0, _dayViewLayout.positionFromDate)(start, min, _this2._totalMin),\n        endSlot: (0, _dayViewLayout.positionFromDate)(end, min, _this2._totalMin)\n      };\n    };\n\n    var selectorClicksHandler = function selectorClicksHandler(box, actionType) {\n      if (!(0, _Selection.isEvent)((0, _reactDom.findDOMNode)(_this2), box)) {\n        _this2._selectSlot(_extends({}, selectionState(box), {\n          action: actionType\n        }));\n      }\n\n      _this2.setState({\n        selecting: false\n      });\n    };\n\n    selector.on(\"selecting\", maybeSelect);\n    selector.on(\"selectStart\", maybeSelect);\n    selector.on(\"beforeSelect\", function (box) {\n      if (_this2.props.selectable !== \"ignoreEvents\") {\n        return;\n      }\n\n      return !(0, _Selection.isEvent)((0, _reactDom.findDOMNode)(_this2), box);\n    });\n    selector.on(\"click\", function (box) {\n      return selectorClicksHandler(box, \"click\");\n    });\n    selector.on(\"doubleClick\", function (box) {\n      return selectorClicksHandler(box, \"doubleClick\");\n    });\n    selector.on(\"select\", function () {\n      if (_this2.state.selecting) {\n        _this2._selectSlot(_extends({}, _this2.state, {\n          action: \"select\"\n        }));\n\n        _this2.setState({\n          selecting: false\n        });\n      }\n    });\n  };\n\n  this._teardownSelectable = function () {\n    if (!_this2._selector) {\n      return;\n    }\n\n    _this2._selector.teardown();\n\n    _this2._selector = null;\n  };\n\n  this._selectSlot = function (_ref6) {\n    var startDate = _ref6.startDate,\n        endDate = _ref6.endDate,\n        action = _ref6.action;\n    var current = startDate;\n    var slots = [];\n\n    while (_dates2.default.lte(current, endDate)) {\n      slots.push(current);\n      current = _dates2.default.add(current, _this2.props.step, \"minutes\");\n    }\n\n    (0, _helpers.notify)(_this2.props.onSelectSlot, {\n      slots: slots,\n      start: startDate,\n      end: endDate,\n      resourceId: _this2.props.resource,\n      action: action\n    });\n  };\n\n  this._select = function () {\n    for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    (0, _helpers.notify)(_this2.props.onSelectEvent, args);\n  };\n\n  this._doubleClick = function () {\n    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    (0, _helpers.notify)(_this2.props.onDoubleClickEvent, args);\n  };\n};\n\nfunction minToDate(min, date) {\n  var dt = new Date(date);\n\n  var totalMins = _dates2.default.diff(_dates2.default.startOf(date, \"day\"), date, \"minutes\");\n\n  dt = _dates2.default.hours(dt, 0);\n  dt = _dates2.default.minutes(dt, totalMins + min);\n  dt = _dates2.default.seconds(dt, 0);\n  return _dates2.default.milliseconds(dt, 0);\n}\n\nDayColumn.propTypes = {\n  events: _propTypes2.default.array.isRequired,\n  components: _propTypes2.default.object,\n  step: _propTypes2.default.number.isRequired,\n  min: _propTypes2.default.instanceOf(Date).isRequired,\n  max: _propTypes2.default.instanceOf(Date).isRequired,\n  getNow: _propTypes2.default.func.isRequired,\n  rtl: _propTypes2.default.bool,\n  titleAccessor: _propTypes3.accessor,\n  tooltipAccessor: _propTypes3.accessor,\n  allDayAccessor: _propTypes3.accessor.isRequired,\n  startAccessor: _propTypes3.accessor.isRequired,\n  endAccessor: _propTypes3.accessor.isRequired,\n  selectRangeFormat: _propTypes3.dateFormat,\n  eventTimeRangeFormat: _propTypes3.dateFormat,\n  eventTimeRangeStartFormat: _propTypes3.dateFormat,\n  eventTimeRangeEndFormat: _propTypes3.dateFormat,\n  showMultiDayTimes: _propTypes2.default.bool,\n  culture: _propTypes2.default.string,\n  timeslots: _propTypes2.default.number,\n  messages: _propTypes2.default.object,\n  selected: _propTypes2.default.object,\n  selectable: _propTypes2.default.oneOf([true, false, \"ignoreEvents\"]),\n  eventOffset: _propTypes2.default.number,\n  longPressThreshold: _propTypes2.default.number,\n  onSelecting: _propTypes2.default.func,\n  onSelectSlot: _propTypes2.default.func.isRequired,\n  onSelectEvent: _propTypes2.default.func.isRequired,\n  onDoubleClickEvent: _propTypes2.default.func.isRequired,\n  className: _propTypes2.default.string,\n  dragThroughEvents: _propTypes2.default.bool,\n  eventPropGetter: _propTypes2.default.func,\n  dayPropGetter: _propTypes2.default.func,\n  dayWrapperComponent: _propTypes3.elementType,\n  eventComponent: _propTypes3.elementType,\n  eventWrapperComponent: _propTypes3.elementType.isRequired,\n  resource: _propTypes2.default.string\n};\nDayColumn.defaultProps = {\n  dragThroughEvents: true,\n  timeslots: 2\n};\nexports.default = DayColumn;","map":null,"metadata":{},"sourceType":"script"}